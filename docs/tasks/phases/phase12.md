# Phase 12: 音声認識精度の向上 (Audio Preprocessing)

## タスク一覧
- [x] **演奏、会話、無音の判断条件を改善し、認識精度を向上させる**
    - **目的**: ファイル全体の音量が小さい場合に会話箇所を無音と判断してしまうのを防ぐため、音声認識の前処理としてゲインを正規化し、演奏・会話・無音区間の判定精度を向上させる。
    - **実装詳細**:
        - **対象**: 
        - **処理内容**:
            - オーディオデータのピークノーマライゼーションまたはRMSノーマライゼーションを適用する。
            - 目標ピークレベル: `-3dBFS`、または目標RMSレベル: `-20dBFS RMS` を目安とする（調整可能にすることが望ましい）。
            - Apple環境 (`iOS 26` / `macOS 26`) において最適な `AVFoundation` や `Accelerate.framework` (vDSP) を活用して実装する。
            - 以下の判断基準を取り入れ、全体音量の大小によらず判定精度を向上させる
              - RMS / short-time energy（ただし補助）
              - Spectral centroid
              - Spectral flatness
              - Spectral flux
              - Harmonicity（倍音規則性）
              - Zero crossing rate
              - 帯域エネルギー比（300–4kHz / 全体）
            - セグメントが分割されすぎないようにする
              - 5秒以下のセグメントは許可しない
            - それでも音量が小さすぎる場合に備えて、Normalize & Re-analyzeボタンを設けてファイル全体の音量の正規化を行う
              - 全体音量の増幅
        - **考慮事項**:
            - 正規化による音質劣化（クリッピング等）を最小限に抑える。
            - 音声認識の待ち時間に影響を与えないよう、処理負荷と実行速度のバランスを考慮する。
    - **検証事項**:
        - 低音量で録音されたファイルに対して、文字起こし精度およびセグメンテーション精度が向上することを確認。
        - 正規化前後の波形データを比較し、意図した通りにゲイン調整が行われていることを確認。
        - 処理時間の計測を行い、ユーザー体験を損なわない範囲であることを確認。
    - **関連ファイル**:
        - `Sources/RehearsalLink/Services/AudioProcessor.swift` (新規作成)
        - `Sources/RehearsalLink/Services/SpeechTranscriptionService.swift` (統合)
