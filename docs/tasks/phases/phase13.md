# Phase 13: AIによるテキスト正規化・要約機能 (AI Text Processing)

## タスク一覧

### 1. LLMサービス基盤とAPIクライアントの実装
- [x] **共通LLMサービスインターフェースの設計**
    - **内容**: 異なるプロバイダー（OpenAI, Anthropic, Google）を統一的に扱えるプロトコル (`LLMServiceProtocol` 等) を定義する。
    - **機能**: テキスト送信、ストリーミング受信、モデル選択、キャンセル処理。
- [ ] **各社APIクライアントの実装**
    - **OpenAI Client**: GPT-4o, GPT-3.5-turbo 等への対応。
    - **Anthropic Client**: Claude 3.5 Sonnet, Haiku 等への対応。
    - **Gemini Client**: Gemini 1.5 Pro, Flash 等への対応。
    - **考慮事項**:
        - `URLSession` を使用したネイティブ実装。
        - APIキーのセキュアな管理（Keychain Accessの利用を検討）。
        - エラーハンドリング（レート制限、ネットワークエラー、APIエラー）。

### 2. テキスト処理ロジック (正規化・要約) の実装
- [ ] **プロンプトテンプレート管理機能**
    - **内容**: 目的に応じたシステムプロンプトやユーザークエリのテンプレートを管理する仕組みを構築する。
    - **テンプレート種別**:
        - **正規化**: 句読点補完、フィラー除去、誤字脱字修正、大文字小文字統一。
        - **要約**: 要点抽出（箇条書き）、短縮要約（1段落）、詳細要約（構造化テキスト）。
- [ ] **処理実行ロジックの実装**
    - **内容**: 選択されたプロバイダー・モデルとプロンプトを使用して、テキスト処理を実行するユースケース/Repositoryの実装。

### 3. UI実装 (Presentation Layer)
- [ ] **設定画面UIの実装**
    - **内容**: 
        - 各サービスのAPIキー入力・保存フォーム。
        - 使用するデフォルトモデルの選択。
        - プロンプトのカスタマイズ（オプション）。
- [ ] **機能選択・実行UIの実装**
    - **内容**: 
        - 文字起こし結果画面における「AI処理」ボタンの配置。
        - 処理タイプ（正規化 or 要約）と詳細オプション（要約レベル等）の選択モーダルまたはパネル。
- [ ] **結果表示・比較UIの実装**
    - **内容**: 
        - オリジナルテキストと処理後テキストの比較表示（Diff表示あるいはタブ切り替え）。
        - 処理結果の保存・置換・コピー機能。
- [ ] **ステータスバーUIの追加**
    - **内容**: AI処理の進行状況（送信中、生成中、完了、エラー）をユーザーにフィードバックするためのステータス表示エリアの実装。

### 4. テストと検証
- [ ] **単体テスト**
    - **内容**: モックサービスを使用したViewModelやロジックのテスト。プロンプト生成ロジックの検証。
- [ ] **結合テスト**
    - **内容**: 実際のAPI（またはサンドボックス環境）を用いた通信テスト、エラーハンドリングの動作確認。

## 関連ファイル
- `Sources/RehearsalLink/Services/LLM/` (新規ディレクトリ)
- `Sources/RehearsalLink/Models/AI/` (新規ディレクトリ)
- `Sources/RehearsalLink/ViewModels/AITextProcessingViewModel.swift`
- `Sources/RehearsalLink/Views/Settings/AISettingsView.swift`
